<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InovaApps · Chatbot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./styles.css" rel="stylesheet">
</head>
<body class="app">
  <header class="brand-gradient py-3 text-white mb-3">
    <div class="container d-flex justify-content-between align-items-center p-0">
      <div class="d-flex align-items-center ms-2">
        <img src="./Fixtures/LogoUnita.avif" alt="Logo da Empresa" style="max-height:40px;">
      </div>
      <div class="text-center flex-grow-1">
        <span class="fs-4 fw-semibold text-white">Chatbot</span>
      </div>
      <div class="d-flex align-items-center me-2 gap-2">
        <a href="./chamados.html" class="btn btn-sm btn-outline-light">Chamados</a>
        <span class="badge bg-light text-dark" id="modeBadge">Demo</span>
      </div>
    </div>
  </header>

  <main class="container chat-wrapper">
    <div class="card chat-card shadow-soft">
      <div class="card-header bg-white d-flex align-items-center justify-content-between">
        <strong>Assistente</strong>
        <div class="d-flex align-items-center gap-2">
          <small class="text-muted">Enter = enviar · Shift+Enter = nova linha</small>
          <button class="btn btn-sm btn-outline-secondary" id="settingsBtn" title="Configurações">⚙️</button>
        </div>
      </div>

      <div id="chatLog" class="chat-log">
        <div class="bubble-row bot">
          <div class="msg bot">
            <div><strong>Oi!</strong> Escreva seu problema. Se o backend estiver rodando, uso <b>Gemini</b>; se não, uso <b>Demo</b>.</div>
            <div class="meta">Assistente · agora</div>
          </div>
        </div>
      </div>

      <div class="chat-input p-3">
        <div class="d-flex gap-2">
          <textarea id="chatInput" class="form-control" rows="1" placeholder="Escreva aqui…"></textarea>
          <button id="sendBtn" class="btn btn-brand">Enviar</button>
        </div>
        <div class="form-text mt-2" id="modeHint">Respostas rápidas e objetivas.</div>
        <div id="typing" class="typing text-muted small mt-2">Assistente está digitando…</div>
      </div>
    </div>
    <div class="text-center my-3">
      <button id="testTicketBtn" class="btn btn-outline-primary">Gerar Chamado de Teste</button>
    </div>
    <script>
      document.getElementById('testTicketBtn').addEventListener('click', () => {
        // Função auxiliar para salvar ticket
        function ticketsLoad(){ try { return JSON.parse(localStorage.getItem('tickets')||'[]'); } catch { return []; } }
        function ticketsSave(list){ localStorage.setItem('tickets', JSON.stringify(list||[])); }
        function cap(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

        const list = ticketsLoad();
        const ticket = {
          id: Date.now(),
          name: 'Teste',
          title: 'Chamado de Teste',
          description: 'Este é um chamado gerado manualmente pelo botão de teste.',
          createdAt: new Date().toISOString()
        };
        list.unshift(ticket);
        ticketsSave(list);
        window.location.href = './chamados.html';
      });
    </script>
  </main>

  <!-- Modal Configurações -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="settingsLabel" class="modal-title">Configurações do Chat</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            O chat tentará usar o <b>backend proxy</b> em <code>/api/gemini-chat</code>.<br>
            Se o backend não estiver disponível, cai em <b>Demo</b> automaticamente.
          </div>
          <div class="mb-3">
            <label class="form-label">Modelo</label>
            <select id="geminiModel" class="form-select">
              <option value="gemini-1.5-flash">gemini-1.5-flash (recomendado)</option>
              <option value="gemini-pro">gemini-pro (texto)</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">URL do backend</label>
            <input id="backendUrl" type="text" class="form-control" placeholder="/api/gemini-chat">
            <div class="form-text">Use relativo (<code>/api/gemini-chat</code>) se o frontend for servido junto do backend.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveSettings" class="btn btn-brand">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./scripts.js"></script>
</body>
</html>